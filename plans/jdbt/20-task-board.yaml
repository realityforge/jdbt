meta:
  project: jdbt
  last_updated: 2026-02-12
  required_full_gates:
    - ./gradlew clean spotlessCheck check fatJar
  statuses:
    - pending
    - in_progress
    - completed
    - cancelled

current_focus: T12

tasks:
  - id: T01
    title: Bootstrap single-module Gradle Java 17 project
    status: completed
    priority: high
    depends_on: []
    acceptance_criteria:
      - Gradle wrapper present and functional
      - Java 17 toolchain configured
      - Error Prone and NullAway enabled
      - palantir-java-format enforced
      - fatJar task produces runnable archive
      - required full gates pass
    files_touched:
      - settings.gradle.kts
      - build.gradle.kts
      - gradle/wrapper/gradle-wrapper.properties
      - gradle/wrapper/gradle-wrapper.jar
      - gradlew
      - gradlew.bat
      - src/main/java/org/realityforge/jdbt/Main.java
      - src/main/java/org/realityforge/jdbt/cli/JdbtCommand.java
      - src/test/java/org/realityforge/jdbt/MainTest.java
    evidence:
      - command: ./gradlew clean spotlessCheck check fatJar
        result: pass
    commit:
      hash: d6a9846
      message: Bootstrap Java project with strict quality gates

  - id: T02
    title: Add GitHub Actions pipeline with early quality gates
    status: completed
    priority: high
    depends_on:
      - T01
    acceptance_criteria:
      - CI runs format check first
      - CI runs compile and static analysis before tests
      - CI runs tests plus coverage gates
      - CI builds fat jar artifact
      - required full gates pass locally
    files_touched:
      - .github/workflows/ci.yml
    evidence:
      - command: ./gradlew clean spotlessCheck check fatJar
        result: pass
    commit:
      hash: e6ad841
      message: Add GitHub Actions quality and verification workflow

  - id: T03
    title: Persist planning artifacts and agent workflow constraints
    status: completed
    priority: high
    depends_on:
      - T01
      - T02
    acceptance_criteria:
      - plans/jdbt files created and consistent with decisions
      - AGENTS.md describes architecture and non-negotiable workflow
      - task board captures execution state and commit evidence
      - required full gates pass
    files_touched:
      - AGENTS.md
      - plans/jdbt/00-requirements.md
      - plans/jdbt/10-implementation-plan.md
      - plans/jdbt/20-task-board.yaml
      - plans/jdbt/30-compatibility-matrix.md
      - plans/jdbt/40-test-strategy.md
    evidence:
      - command: ./gradlew clean spotlessCheck check fatJar
        result: pass
    commit:
      hash: 07ff3f3
      message: Add project requirements, plan, and task board artifacts

  - id: T04
    title: Implement strict jdbt.yml and repository.yml model parsing
    status: completed
    priority: high
    depends_on:
      - T03
    acceptance_criteria:
      - Parse jdbt.yml with strict unknown-key rejection
      - Parse repository.yml with strict unknown-key rejection
      - Apply Ruby-compatible defaults for config model
      - Validate import and module-group module references against repository modules
      - required full gates pass
    files_touched:
      - src/main/java/org/realityforge/jdbt/config/*
      - src/main/java/org/realityforge/jdbt/repository/*
      - src/test/java/org/realityforge/jdbt/config/*
      - src/test/java/org/realityforge/jdbt/repository/*
      - build.gradle.kts
      - plans/jdbt/20-task-board.yaml
      - plans/jdbt/30-compatibility-matrix.md
    evidence:
      - command: ./gradlew clean spotlessCheck check fatJar
        result: pass
    commit:
      hash: e1edd4b
      message: Add strict YAML loaders for project and repository config

  - id: T05
    title: Implement repository merge and ordering semantics
    status: completed
    priority: high
    depends_on:
      - T04
    acceptance_criteria:
      - Pre/local/post merge order behavior encoded
      - Duplicate module definitions rejected with diagnostics
      - merge result preserves module order and map content
      - required full gates pass
    files_touched:
      - src/main/java/org/realityforge/jdbt/repository/RepositoryConfigMerger.java
      - src/test/java/org/realityforge/jdbt/repository/RepositoryConfigMergerTest.java
      - plans/jdbt/20-task-board.yaml
      - plans/jdbt/30-compatibility-matrix.md
    evidence:
      - command: ./gradlew clean spotlessCheck check fatJar
        result: pass
    commit:
      hash: 006aeba
      message: Implement repository merge semantics with duplicate checks

  - id: T06
    title: Implement file resolution and artifact overlay semantics
    status: completed
    priority: high
    depends_on:
      - T05
    acceptance_criteria:
      - Collect files from search dirs with index-aware ordering
      - Merge post/pre artifact files with basename-precedence semantics
      - Reject duplicate basenames and invalid index entries
      - Resolve fixtures with strict unexpected-file validation
      - Resolve module files with disk > post > pre precedence
      - required full gates pass
    files_touched:
      - src/main/java/org/realityforge/jdbt/files/*
      - src/test/java/org/realityforge/jdbt/files/*
      - plans/jdbt/20-task-board.yaml
      - plans/jdbt/30-compatibility-matrix.md
    evidence:
      - command: ./gradlew clean spotlessCheck check fatJar
        result: pass
    commit:
      hash: e2726a9
      message: Implement file resolution with artifact overlay precedence

  - id: T07
    title: Implement runtime core commands and flow orchestration
    status: completed
    priority: high
    depends_on:
      - T06
    acceptance_criteria:
      - Runtime status/create/drop flows implemented
      - Module group up/down orchestration implemented
      - Dataset load/create-with-dataset orchestration implemented
      - Runtime driver abstraction introduced for orchestration testing
      - required full gates pass
    files_touched:
      - src/main/java/org/realityforge/jdbt/db/*
      - src/main/java/org/realityforge/jdbt/runtime/*
      - src/main/java/org/realityforge/jdbt/repository/RepositoryConfig.java
      - src/test/java/org/realityforge/jdbt/runtime/*
      - src/test/java/org/realityforge/jdbt/repository/RepositoryConfigTest.java
      - plans/jdbt/20-task-board.yaml
      - plans/jdbt/30-compatibility-matrix.md
    evidence:
      - command: ./gradlew clean spotlessCheck check fatJar
        result: pass
    commit:
      hash: bad3ca8
      message: Implement core runtime orchestration and driver abstraction

  - id: T08
    title: Implement import flow and --resume-at behavior
    status: completed
    priority: high
    depends_on:
      - T07
    acceptance_criteria:
      - Standalone import flow implemented with delete/import sequencing
      - --resume-at semantics implemented and validated
      - create-by-import runtime flow implemented
      - module-group import delete-first behavior enforced
      - import hook SQL supports source/target placeholders
      - required full gates pass
    files_touched:
      - src/main/java/org/realityforge/jdbt/runtime/RuntimeEngine.java
      - src/main/java/org/realityforge/jdbt/db/DbDriver.java
      - src/test/java/org/realityforge/jdbt/runtime/RuntimeEngineTest.java
      - src/test/java/org/realityforge/jdbt/runtime/RuntimeDatabaseTest.java
      - src/main/java/org/realityforge/jdbt/runtime/RuntimeDatabase.java
      - plans/jdbt/20-task-board.yaml
      - plans/jdbt/30-compatibility-matrix.md
    evidence:
      - command: ./gradlew clean spotlessCheck check fatJar
        result: pass
    commit:
      hash: d56a308
      message: Implement import orchestration with resume-at semantics

  - id: T09
    title: Implement migration flow and migration tracking
    status: completed
    priority: high
    depends_on:
      - T07
    acceptance_criteria:
      - migrate command runtime flow implemented
      - migration setup integrated into create/create-with-dataset/create-by-import flows
      - release-boundary migration semantics implemented
      - record/force/perform migration modes implemented
      - required full gates pass
    files_touched:
      - src/main/java/org/realityforge/jdbt/runtime/RuntimeEngine.java
      - src/main/java/org/realityforge/jdbt/runtime/RuntimeDatabase.java
      - src/main/java/org/realityforge/jdbt/runtime/RuntimeDatabaseFactory.java
      - src/main/java/org/realityforge/jdbt/db/DbDriver.java
      - src/test/java/org/realityforge/jdbt/runtime/RuntimeEngineTest.java
      - src/test/java/org/realityforge/jdbt/runtime/RuntimeDatabaseTest.java
      - src/test/java/org/realityforge/jdbt/runtime/RuntimeDatabaseFactoryTest.java
      - plans/jdbt/20-task-board.yaml
      - plans/jdbt/30-compatibility-matrix.md
    evidence:
      - command: ./gradlew clean spotlessCheck check fatJar
        result: pass
    commit:
      hash: 6c23408
      message: Implement migration orchestration and tracking semantics

  - id: T10
    title: Implement deterministic packaging and reproducibility tests
    status: completed
    priority: high
    depends_on:
      - T06
    acceptance_criteria:
      - deterministic ZIP writer implemented using JDK ZIP APIs
      - package-data assembly preserves Ruby directory selection semantics
      - ZIP entries use STORED method with fixed timestamps
      - entry ordering is stable and lexical
      - reproducibility tests verify byte-for-byte identical output
      - required full gates pass
    files_touched:
      - src/main/java/org/realityforge/jdbt/packaging/*
      - src/test/java/org/realityforge/jdbt/packaging/*
      - plans/jdbt/20-task-board.yaml
      - plans/jdbt/30-compatibility-matrix.md
    evidence:
      - command: ./gradlew clean spotlessCheck check fatJar
        result: pass
    commit:
      hash: 66f2d08
      message: Implement deterministic package-data assembly and zip output

  - id: T11
    title: Implement CLI commands and argument validation
    status: completed
    priority: high
    depends_on:
      - T07
      - T08
      - T09
      - T10
    acceptance_criteria:
      - java-style picocli command surface implemented for initial command set
      - explicit --target-* and --source-* connection options enforced
      - --password, --password-env, and --password-stdin modes supported
      - runtime loader resolves jdbt.yml and repository merge semantics for command execution
      - package-data command wired to deterministic packaging flow
      - required full gates pass
    files_touched:
      - src/main/java/org/realityforge/jdbt/cli/*
      - src/main/java/org/realityforge/jdbt/db/DbDriverFactory.java
      - src/main/java/org/realityforge/jdbt/db/NoOpDbDriver.java
      - src/main/java/org/realityforge/jdbt/cli/JdbtCommand.java
      - src/test/java/org/realityforge/jdbt/cli/*
      - src/test/java/org/realityforge/jdbt/db/DbDriverFactoryTest.java
      - plans/jdbt/20-task-board.yaml
      - plans/jdbt/30-compatibility-matrix.md
    evidence:
      - command: ./gradlew clean spotlessCheck check fatJar
        result: pass
    commit:
      hash: pending
      message: pending

  - id: T12
    title: Final documentation and parity closure
    status: pending
    priority: high
    depends_on:
      - T11

  - id: T13
    title: Add PostgreSQL support in phase 2
    status: pending
    priority: medium
    depends_on:
      - T12

history:
  - timestamp: 2026-02-12
    task: T01
    commit: d6a9846
    note: Foundation scaffold and build gates established.
  - timestamp: 2026-02-12
    task: T02
    commit: e6ad841
    note: CI workflow added with early gate ordering.
  - timestamp: 2026-02-12
    task: T03
    commit: 07ff3f3
    note: Planning artifacts and AGENTS workflow constraints added.
  - timestamp: 2026-02-12
    task: T04
    commit: e1edd4b
    note: Strict jdbt.yml and repository.yml parsing with validation and tests added.
  - timestamp: 2026-02-12
    task: T05
    commit: 006aeba
    note: Repository merge semantics implemented with duplicate-module safety.
  - timestamp: 2026-02-12
    task: T06
    commit: e2726a9
    note: File resolution and artifact overlay semantics implemented with strict validation.
  - timestamp: 2026-02-12
    task: T07
    commit: bad3ca8
    note: Runtime core orchestration implemented with no-DB execution tests.
  - timestamp: 2026-02-12
    task: T08
    commit: d56a308
    note: Import and resume runtime flow implemented with module-group delete-first behavior.
  - timestamp: 2026-02-12
    task: T09
    commit: 6c23408
    note: Migration runtime flow and create-time migration setup implemented.
  - timestamp: 2026-02-12
    task: T10
    commit: 66f2d08
    note: Deterministic package-data assembly and reproducible zip writer implemented.
  - timestamp: 2026-02-12
    task: T11
    commit: pending
    note: CLI command surface and argument validation integrated with runtime loading.
